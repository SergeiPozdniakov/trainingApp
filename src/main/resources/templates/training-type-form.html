<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${trainingType.id != null} ? 'Редактирование направления' : 'Новое направление'">
    Новое направление
  </title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .period-option {
        cursor: pointer;
        transition: all 0.3s;
    }
    .period-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .period-option.selected {
        border-color: #0d6efd !important;
        background-color: rgba(13, 110, 253, 0.05);
    }
  </style>
</head>
<body class="bg-light">
<div class="container mt-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a th:href="@{/dashboard}">Главная</a></li>
      <li class="breadcrumb-item"><a th:href="@{/training-types}">Направления обучения</a></li>
      <li class="breadcrumb-item active" th:text="${trainingType.id != null} ? 'Редактирование' : 'Создание'"></li>
    </ol>
  </nav>

  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header" th:classappend="${trainingType.id != null} ? 'bg-warning' : 'bg-primary'">
          <h4 class="card-title text-white mb-0">
            <i th:classappend="${trainingType.id != null} ? 'fas fa-edit' : 'fas fa-plus-circle'"
               class="me-2"></i>
            <span th:text="${trainingType.id != null} ? 'Редактирование направления' : 'Новое направление'"></span>
          </h4>
        </div>

        <div class="card-body p-4">
          <form th:action="@{${trainingType.id != null} ? '/training-types/' + ${trainingType.id} : '/training-types'}"
                method="post" th:object="${trainingType}">

            <div th:if="${trainingType.id != null}">
              <input type="hidden" name="_method" value="put" />
            </div>

            <!-- Название направления -->
            <div class="mb-4">
              <label for="name" class="form-label fw-bold">
                <i class="fas fa-signature me-1"></i>Название направления
              </label>
              <input type="text" class="form-control form-control-lg" id="name"
                     th:field="*{name}" required
                     placeholder="Например: Пожарная безопасность">
              <div class="form-text">
                Название будет отображаться как заголовок столбца в таблице сотрудников
              </div>
              <div th:if="${#fields.hasErrors('name')}" class="invalid-feedback d-block">
                <span th:errors="*{name}"></span>
              </div>
            </div>

            <!-- Периодичность -->
            <div class="mb-4">
              <label class="form-label fw-bold">
                <i class="fas fa-calendar-alt me-1"></i>Периодичность проверки знаний
              </label>

              <div class="row g-3 mb-3">
                <!-- Стандартные периоды -->
                <div class="col-md-4">
                  <div class="card period-option"
                       onclick="selectPeriod(12)"
                       id="period12">
                    <div class="card-body text-center">
                      <h5 class="card-title text-primary">12 месяцев</h5>
                      <p class="card-text small">Ежегодная проверка</p>
                      <div class="form-check d-none">
                        <input class="form-check-input" type="radio"
                               th:field="*{validityPeriodMonths}"
                               value="12" id="period12Radio">
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card period-option"
                       onclick="selectPeriod(36)"
                       id="period36">
                    <div class="card-body text-center">
                      <h5 class="card-title text-info">36 месяцев</h5>
                      <p class="card-text small">Трехлетняя проверка</p>
                      <div class="form-check d-none">
                        <input class="form-check-input" type="radio"
                               th:field="*{validityPeriodMonths}"
                               value="36" id="period36Radio">
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="card period-option"
                       onclick="selectPeriod(60)"
                       id="period60">
                    <div class="card-body text-center">
                      <h5 class="card-title text-success">60 месяцев</h5>
                      <p class="card-text small">Пятилетняя проверка</p>
                      <div class="form-check d-none">
                        <input class="form-check-input" type="radio"
                               th:field="*{validityPeriodMonths}"
                               value="60" id="period60Radio">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Кастомный период -->
              <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-cog"></i>
                                    </span>
                <input type="number" class="form-control" id="customPeriod"
                       th:field="*{validityPeriodMonths}"
                       min="1" max="120"
                       placeholder="Или укажите другую периодичность в месяцах">
                <span class="input-group-text">месяцев</span>
              </div>
              <div class="form-text">
                Укажите периодичность в месяцах (например: 6, 12, 24, 36, 60)
              </div>
              <div th:if="${#fields.hasErrors('validityPeriodMonths')}" class="invalid-feedback d-block">
                <span th:errors="*{validityPeriodMonths}"></span>
              </div>
            </div>

            <!-- Описание -->
            <div class="mb-4">
              <label for="description" class="form-label fw-bold">
                <i class="fas fa-align-left me-1"></i>Описание направления
              </label>
              <textarea class="form-control" id="description"
                        th:field="*{description}" rows="3"
                        placeholder="Краткое описание направления обучения..."></textarea>
              <div class="form-text">
                Необязательное поле. Можно указать требования, нормативные документы и т.д.
              </div>
            </div>

            <!-- Кнопки действия -->
            <div class="d-flex justify-content-between mt-4">
              <a th:href="@{/training-types}" class="btn btn-outline-secondary">
                <i class="fas fa-times me-1"></i> Отмена
              </a>
              <button type="submit" class="btn"
                      th:classappend="${trainingType.id != null} ? 'btn-warning' : 'btn-primary'">
                <i th:classappend="${trainingType.id != null} ? 'fas fa-save' : 'fas fa-check-circle'"
                   class="me-1"></i>
                <span th:text="${trainingType.id != null} ? 'Сохранить изменения' : 'Создать направление'"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Предупреждение -->
      <div th:if="${trainingType.id != null && trainingType.certificates.size() > 0}"
           class="alert alert-warning mt-3">
        <i class="fas fa-exclamation-triangle me-2"></i>
        По этому направлению есть <strong th:text="${trainingType.certificates.size()}"></strong> сертификатов.
        Изменение периодичности повлияет на расчет дат следующих проверок.
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Инициализация выбранного периода
      const currentPeriod = document.querySelector('input[name="validityPeriodMonths"]:checked');
      if (currentPeriod) {
          selectPeriod(parseInt(currentPeriod.value));
      }

      // Обработка кастомного ввода
      document.getElementById('customPeriod').addEventListener('input', function() {
          const value = parseInt(this.value);
          if (!isNaN(value)) {
              document.querySelectorAll('.period-option').forEach(option => {
                  option.classList.remove('selected');
              });
          }
      });
  });

  function selectPeriod(months) {
      // Снимаем выделение со всех опций
      document.querySelectorAll('.period-option').forEach(option => {
          option.classList.remove('selected');
      });

      // Выделяем выбранную опцию
      const selectedOption = document.getElementById('period' + months);
      if (selectedOption) {
          selectedOption.classList.add('selected');
      }

      // Устанавливаем значение в кастомное поле
      document.getElementById('customPeriod').value = months;

      // Выбираем соответствующий radio
      const radio = document.getElementById('period' + months + 'Radio');
      if (radio) {
          radio.checked = true;
      }
  }
</script>
</body>
</html>